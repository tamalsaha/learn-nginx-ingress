# HAProxy configuration generated by https://github.com/voyagermesh
# DO NOT EDIT!
global
  stats socket /var/run/haproxy.sock mode 600 expose-fd listeners level user
  server-state-base /shared/etc/haproxy/state
  server-state-file global
  # https://cbonte.github.io/haproxy-dconv/2.0/configuration.html#4.2-log%20global
  log stdout format raw daemon            # send everything to stdout
  log stderr format raw daemon notice     # send important events to stderr
  tune.ssl.default-dh-param 2048
  ssl-default-bind-ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!3DES:!MD5:!PSK
  # https://github.com/haproxytech/haproxy-lua-http
  # lua-prepend-path /usr/share/haproxy/?/http.lua
  # lua-load /usr/share/haproxy/auth-request.lua # https://github.com/TimWolla/haproxy-auth-request
  hard-stop-after 30s
defaults
  log global
  # https://cbonte.github.io/haproxy-dconv/1.7/configuration.html#4.2-option%20abortonclose
  # https://github.com/voyagermesh/voyager/pull/403
  option dontlognull
  option http-server-close
  # Timeout values
  timeout client 50s
  timeout client-fin 50s
  timeout connect 5s
  timeout server 50s
  timeout tunnel 50s
  # Configure error files
  # default traffic mode is http
  # mode is overwritten in case of tcp services
  mode http

frontend nats-front
  bind *:4223
  mode tcp
  option tcplog
  default_backend nats-backend
backend nats-backend
  mode tcp
  option tcplog
  server server-0 127.0.01:4222 check